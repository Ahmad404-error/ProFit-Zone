{% extends 'main/layout.html' %}
{% load static %}

{% block title %}
Оформление заказа
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4 text-center">Оформление заказа</h1>

    <!-- Форма для ввода адреса и выбора самовывоза -->
    <form id="checkout-form" method="POST" style="max-width: 600px; margin: 0 auto;">
        {% csrf_token %}
        
        <!-- Секция доставки -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h3 class="card-title">Детали доставки</h3>
                
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="pickup-option" name="pickup" value="pickup">
                    <label class="form-check-label" for="pickup-option">Самовывоз</label>
                </div>
                
                <!-- Адрес доставки -->
                <div id="address-fields">
                    <div class="mb-3">
                        <label for="address" class="form-label">Адрес доставки</label>
                        <input type="text" class="form-control" id="address" name="address" placeholder="Улица, дом, квартира" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone-number" class="form-label">Номер телефона</label>
                        <input type="tel" class="form-control" id="phone-number" name="phone-number" placeholder="+70000000000" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Секция с деталями заказа -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h3 class="card-title">Ваш заказ</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Товар</th>
                            <th>Количество</th>
                            <th>Цена</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cart.items.all %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.get_total_price }} ₽</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <h4 class="text-end">Итого: <strong>{{ cart.get_total_price }} ₽</strong></h4>
            </div>
        </div>

        <!-- Кнопка Оплатить -->
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">Оплатить</button>
        </div>
    </form>
</div>

<!-- Подключаем jQuery и Bootstrap сначала -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">

<!-- Подключаем Dadata после загрузки основного контента -->
<script src="https://cdn.jsdelivr.net/npm/suggestions-jquery@20.1.0/dist/js/jquery.suggestions.min.js"></script>

<script>
$(document).ready(function() {
    // Инициализация подсказок для поля адреса
    $("#address").suggestions({
        token: "379f5d20568c976d8fe913e09fcf6491bd12a01c",
        type: "ADDRESS",
        onSelect: function(suggestion) {
            console.log(suggestion);
        }
    });

    // Обработчик переключения "Самовывоз"
    $('#pickup-option').on('change', function () {
        const addressFields = $('#address-fields');
        if (this.checked) {
            addressFields.hide(); // Скрываем поля адреса
            $('#checkout-form').submit(); // Автоматически отправляем форму
        } else {
            addressFields.show(); // Показываем поля адреса
        }
    });
});
</script>

{% endblock %}
