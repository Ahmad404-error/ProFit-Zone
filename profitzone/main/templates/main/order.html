{% extends 'main/layout.html' %}
{% load static %}

{% block title %}
Оформление заказа
{% endblock %}

{% block content %}
<style>

    input.form-control {
        padding: 10px; /* Убедитесь, что padding правильный */
        margin-left: 0; /* Убирает сдвиг влево */
        margin-right: 0; /* Убирает сдвиг вправо */
        width: 100%; /* Занимает всю доступную ширину */
        box-sizing: border-box; /* Учет всех границ и отступов */
    }
    .form-control {
        padding: 10px;
        margin: 0;
        width: 100%;
        box-sizing: border-box;
    }

    input[type="text"], input[type="tel"] {
        display: block;
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        text-align: center;
    }

    ::placeholder { 
        color: #888; 
        opacity: 1;
    }

    :-ms-input-placeholder { /* IE 10-11 */
        color: #888;
    }

    ::-ms-input-placeholder { /* Microsoft Edge */
        color: #888;
    }

    .container {
        max-width: 100%;
        margin: 0 auto;
        padding: 0 15px;
        box-sizing: border-box;
    }

    .card {
        margin-bottom: 20px;
    }
</style>

<div class="container my-5">
    <h1 class="mb-4 text-center">Оформление заказа</h1>

    <!-- Форма для ввода адреса и выбора самовывоза -->
    <form id="checkout-form" method="POST" style="max-width: 600px; margin: 0 auto;">
        {% csrf_token %}
        
        <!-- Секция доставки -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h3 class="card-title">Детали доставки</h3>
                
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="pickup-option" name="pickup" value="pickup">
                    <label class="form-check-label" for="pickup-option">Самовывоз</label>
                </div>
                
                <!-- Адрес доставки -->
                <div id="address-fields">
                    <div class="mb-3">
                        <label for="address" class="form-label">Адрес доставки</label>
                        <input type="text" class="form-control" id="address" name="address" placeholder="Улица, дом, квартира" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone-number" class="form-label">Номер телефона</label>
                        <input type="tel" class="form-control" id="phone-number" name="phone-number" placeholder="+70000000000" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- Секция с деталями заказа -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h3 class="card-title">Ваш заказ</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Товар</th>
                            <th>Количество</th>
                            <th>Цена</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cart.items.all %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.get_total_price }} ₽</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <h4 class="text-end">Итого: <strong>{{ cart.get_total_price }} ₽</strong></h4>
            </div>
        </div>

        <!-- Кнопка Оплатить -->
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">Оплатить</button>
        </div>
    </form>
</div>

<!-- Подключаем jQuery и Bootstrap сначала -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">

<!-- Подключаем Dadata после загрузки основного контента -->
<script src="https://cdn.jsdelivr.net/npm/suggestions-jquery@20.1.0/dist/js/jquery.suggestions.min.js"></script>

<script>
$(document).ready(function() {
    // Инициализация подсказок для поля адреса
    $("#address").suggestions({
        token: "379f5d20568c976d8fe913e09fcf6491bd12a01c",
        type: "ADDRESS",
        onSelect: function(suggestion) {
            console.log(suggestion);
        }
    });

    // Принудительная перерисовка полей
    setTimeout(function() {
        $("#address, #phone-number").css('display', 'none').css('display', 'block');
    }, 100);

    // Обработчик переключения "Самовывоз"
    document.getElementById('pickup-option').addEventListener('change', function () {
        const addressFields = document.getElementById('address-fields');
        if (this.checked) {
            addressFields.style.display = 'none';
        } else {
            addressFields.style.display = 'block';
        }
    });
});

</script>

{% endblock %}
