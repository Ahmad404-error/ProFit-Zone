{% extends 'main/layout.html' %}
{% load static %}

{% block title %}
{{ product.name }}
{% endblock %}

{% block content %}
<div class="product-card">
    <img src="{{ product.img.url }}" alt="{{ product.name }}">
    <h4>{{ product.name }}</h4>
    <p class="price">{{ product.price }}</p>
    <button class="add-to-cart-btn" data-product-id="{{ product.id }}">В корзину</button>
</div>
<script>
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            const quantity = 1; 
            fetch('/add-to-cart/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    'product_id': productId,
                    'quantity': quantity,
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Товар добавлен в корзину!');
                    // Можно обновить количество товаров в корзине на странице
                    document.querySelector('#cart-count').innerText = data.cart_quantity;
                } else {
                    alert('Ошибка: ' + data.message);
                }
            })
            .catch(error => console.error('Ошибка:', error));
        });
    });
</script>
{% endblock %}